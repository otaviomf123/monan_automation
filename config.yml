# Configuração do MONAN/MPAS
# =============================

# Configurações gerais
general:
  base_dir: "/home/cepel/otaviomf123/outputs"
  forecast_days: 10  # Dias de previsão
  
# Configurações de data
dates:
  run_date: "20250921"  # Data da rodada (AAAAmmdd)
  cycle: "00"           # Hora da rodada (00, 06, 12, 18)
  start_time: "2025-09-21_00:00:00"
  end_time: "2025-10-01_00:00:00"

# Data source selection
data_source:
  type: "gfs"  # Options: "gfs" or "era5"

# URLs e dados de entrada
data_sources:
  gfs_base_url: "https://noaa-gfs-bdp-pds.s3.amazonaws.com"
  forecast_hours:
    start: 0
    end: 240  # 10 dias * 24 horas
    step: 3   # Intervalo de 3 horas

# ERA5 specific configuration (only used when data_source.type = "era5")
era5:
  # Pressure levels (user configurable)
  pressure_levels:
    - '10'
    - '30'
    - '50'
    - '70'
    - '100'
    - '150'
    - '200'
    - '250'
    - '300'
    - '350'
    - '400'
    - '500'
    - '600'
    - '650'
    - '700'
    - '750'
    - '775'
    - '800'
    - '825'
    - '850'
    - '875'
    - '900'
    - '925'
    - '950'
    - '975'
    - '1000'
  
  # Grid resolution
  grid_resolution: '0.25/0.25'
  
  # Download interval in hours
  download_interval_hours: 3

# Caminhos dos executáveis e arquivos
paths:
  # WPS
  wps_dir: "/home/cepel/otaviomf123/mpas/WPS"
  link_grib: "/home/cepel/otaviomf123/monan/WPS/link_grib.csh"
  ungrib_exe: "/home/cepel/otaviomf123/monan/WPS/ungrib.exe"
  vtable_gfs: "/home/cepel/otaviomf123/monan/WPS/ungrib/Variable_Tables/Vtable.GFS"
  vtable_ecmwf: "/home/cepel/otaviomf123/monan/WPS/ungrib/Variable_Tables/Vtable.ECMWF"
  
  # MPAS/MONAN
  mpas_init_exe: "/home/cepel/otaviomf123/monan/INIT/init_atmosphere_model"
  monan_exe: "/home/cepel/otaviomf123/monan/MONAN/atmosphere_model"
  monan_dir: "/home/cepel/otaviomf123/monan/MONAN"
  
  # Dados geográficos e malha
  geog_data_path: "/mnt/cempa/01/otavio/atm_models/geog/mpas_static"
  wps_geog_path: "/glade/work/wrfhelp/WPS_GEOG/"
  static_file: "/home/cepel/otaviomf123/static_files/brasil_circle.static.nc"
  decomp_file_prefix: "/home/cepel/otaviomf123/static_files/brasil_circle.graph.info.part."
  
  # Arquivo de condição inicial
  init_filename: "brasil_circle.init.nc"
  
  # Arquivos de streams (templates)
  stream_diagnostics: "./templates/stream_list.atmosphere.diagnostics"
  stream_output: "./templates/stream_list.atmosphere.output"
  stream_surface: "./templates/stream_list.atmosphere.surface"
  streams_atmosphere: "./templates/streams.atmosphere"
  
  # Templates de streams
  stream_init_template: "./templates/streams.init_atmosphere"
  stream_atmosphere_template: "./templates/streams.atmosphere"
  stream_diagnostics_template: "./templates/stream_list.atmosphere.diagnostics"

# Configurações do domínio
domain:
  config_len_disp: 10000.0  # Resolução da grade mínima (metros)

# Physics configuration
physics:
  # Vertical grid
  nvertlevels: 55      # Number of vertical levels
  nsoillevels: 4       # Number of soil levels
  nfglevels: 34        # First-guess vertical levels
  
  # Time stepping
  dt: 60.0             # Model time step (seconds)
  
  # Physics suite (pre-configured combinations)
  physics_suite: "mesoscale_reference_monan"
  # Options: "mesoscale_reference", "convection_permitting", "suite_HRRR_gf"
  
  # Microphysics schemes
  microphysics:
    scheme: "wsm6"   
    
  # Convection schemes
  convection:
    scheme: "grell_freitas"  
    
  # Planetary Boundary Layer (PBL)
  pbl:
    scheme: "mynn"     
    
  # Surface layer
  surface_layer:
    scheme: "sf_mynn"  
    
  # Land surface model
  land_surface:
    scheme: "noah"   
    
  # Radiation schemes
  radiation:
    # Longwave radiation
    longwave:
      scheme: "rrtmg"  # Options: "rrtmg", "cam", "rrtmg_lw"
      interval: "00:30:00"  # How often to call LW radiation (HH:MM:SS)
      
    # Shortwave radiation  
    shortwave:
      scheme: "rrtmg"  # Options: "rrtmg", "cam", "rrtmg_sw"
      interval: "00:30:00"  # How often to call SW radiation (HH:MM:SS)
      
    # Radiation options
    cloud_fraction_scheme: "cld_fraction"  # Options: "cld_fraction", "cld_incidence"
    
  # Gravity wave drag
  gravity_wave_drag:
    enabled: true
    
  
  # Other physics options
  options:
    sst_update: false           # Update SST during run
    sstdiurn_update: false      # Diurnal SST update
    deepsoiltemp_update: false  # Deep soil temperature update

# GF-MONAN cold pool parameterization configuration
gf_monan:
  config_gf_pcvol: 0           # Cold pool volume parameterization (0=off, 1=on)
  config_gf_cporg: 1           # Cold pool organization (0=off, 1=on)
  config_gf_gustf: 1           # Gust factor parameterization (0=off, 1=on)  
  config_gf_sub3d: 0           # 3D subsidence (0=off, 1=on)

# Configurações de execução
execution:
  backend: "slurm"     # Backend de execução: "slurm" ou "mpirun" (padrão: slurm)
  cores: 256           # Número de processos MPI

# Configurações do SLURM
slurm:
  partition: "cpu"     # Partição do SLURM para submissão do job
  nodes: 2             # Número de nós a serem utilizados
  ntasks_per_node: 128 # Número de tasks por nó
  memory: "300G"       # Memória solicitada por nó
  job_name: "MPAS_model" # Nome do job no SLURM
  infiniband: "-iface ibp65s0"  # Flag infiniband para execução SLURM ( editável)

# Configurações do mpirun
mpirun:
  hosts: []            # Lista de hosts para execução (se vazio, não usa --host)
  np:                  # Número total de processos (-np). Se não especificado, usa execution.cores
  extra_args: []       # Lista de argumentos extras para o comando mpirun
  infiniband: "-iface ibp65s0"  # Flag infiniband para mpirun ( editável)
  timeout_hours: 24    # Timeout de execução em horas

# Logging
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "monan_execution.log"

# Configurações de conversão para grade regular
conversion:
  enabled: true  # Habilitar conversão automática
  grid:
    lon_min: -90
    lon_max: -20
    lat_min: -45
    lat_max: 25
    resolution: 0.1  # Resolução em graus
    max_dist_km: 30  # Distância máxima para interpolação em km
